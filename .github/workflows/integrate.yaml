name: Integrate

on:
  pull_request:
    branches:
      - main

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
  cancel-in-progress: true

# permissions:
#   contents: read

env:
  NODE_ENV: development

jobs:
  audit:
    name: Audit
    runs-on: ubuntu-22.04
    env:
      MY_SECRET: ${{ secrets.MY_SECRET }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      # - name: Install Node
      #   uses: actions/setup-node@v3
      #   with:
      #     node-version: 18
      #     cache: npm
      # # - name: Install Dependencies
      # #   run: npm ci
      - name: Audit
        run: bash scripts/audit.sh
      - run: echo "${NODE_ENV}"
      - run: echo "${MY_SECRET}"
# jobs:
#   trunk_check:
#     name: Trunk Check Runner
#     runs-on: ubuntu-22.04

#     steps:
#       - name: Checkout
#         uses: actions/checkout@v3

#       - name: Use Node.js
#         uses: actions/setup-node@v3
#         with:
#           node-version: "18.x"
#           cache: "npm"
#       - name: Install dependencies
#         run: npm ci
#       - run: npm run build --if-present
#       - run: npm test

#       - name: Trunk Check
#         uses: trunk-io/trunk-action@v1

# # Cache dependencies, generated files?, and artifacts (docs, website, target files, logs / changelog, containers)
# # jobs:
# #   example-job:
#     steps:
#       - name: Cache node modules
#         uses: actions/cache@v3
#         env:
#           cache-name: cache-node-modules
#         with:
#           path: ~/.npm
#           key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/package-lock.json') }}
#           restore-keys: |
#             ${{ runner.os }}-build-${{ env.cache-name }}-

# what do i do about versioning? like functions and docs which can be versioned diff. does it matter?

# when reusable workflow updates (should be semver), make sure all the workflows using it are retriggered? or not worth?

#Any environment variables set in an env context defined at the workflow level in the caller workflow are not propagated to the called workflow.
#To reuse variables in multiple workflows, set them at the organization, repository, or environment levels and reference them using the vars context.
#cache artifacts from build and artifacts from test to be used in code coverage test???
